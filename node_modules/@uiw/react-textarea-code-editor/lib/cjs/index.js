"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard").default;

Object.defineProperty(exports, "__esModule", {
  value: true
});
var _exportNames = {};
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _react = _interopRequireWildcard(require("react"));

var _utils = require("./utils");

var _shortcuts = _interopRequireDefault(require("./shortcuts"));

var styles = _interopRequireWildcard(require("./styles"));

var _SelectionText = require("./SelectionText");

Object.keys(_SelectionText).forEach(function (key) {
  if (key === "default" || key === "__esModule") return;
  if (Object.prototype.hasOwnProperty.call(_exportNames, key)) return;
  if (key in exports && exports[key] === _SelectionText[key]) return;
  Object.defineProperty(exports, key, {
    enumerable: true,
    get: function get() {
      return _SelectionText[key];
    }
  });
});
var _excluded = ["prefixCls", "value", "padding", "minHeight", "placeholder", "language", "className", "style", "onChange"];

var _default = /*#__PURE__*/_react.default.forwardRef(function (props, ref) {
  var _props$prefixCls = props.prefixCls,
      prefixCls = _props$prefixCls === void 0 ? 'w-tc-editor' : _props$prefixCls,
      _ = props.value,
      _props$padding = props.padding,
      padding = _props$padding === void 0 ? 10 : _props$padding,
      _props$minHeight = props.minHeight,
      minHeight = _props$minHeight === void 0 ? 16 : _props$minHeight,
      placeholder = props.placeholder,
      language = props.language,
      className = props.className,
      style = props.style,
      _onChange = props.onChange,
      other = (0, _objectWithoutProperties2.default)(props, _excluded);

  var _useState = (0, _react.useState)(props.value || ''),
      _useState2 = (0, _slicedToArray2.default)(_useState, 2),
      value = _useState2[0],
      setValue = _useState2[1];

  (0, _react.useEffect)(function () {
    return setValue(props.value || '');
  }, [props.value]);
  var textRef = (0, _react.useRef)(null);
  (0, _react.useImperativeHandle)(ref, function () {
    return textRef.current;
  });
  var contentStyle = {
    paddingTop: padding,
    paddingRight: padding,
    paddingBottom: padding,
    paddingLeft: padding
  };
  var htmlStr = (0, _react.useMemo)(function () {
    return (0, _utils.processHtml)("<pre aria-hidden=true><code ".concat(language ? "class=\"language-".concat(language, "\"") : '', " >").concat((0, _utils.htmlEncode)(String(value || '')), "</code><br /></pre>"));
  }, [value, language]);
  var preView = (0, _react.useMemo)(function () {
    return /*#__PURE__*/_react.default.createElement("div", {
      style: (0, _objectSpread2.default)((0, _objectSpread2.default)((0, _objectSpread2.default)({}, styles.editor), contentStyle), {}, {
        minHeight: minHeight
      }),
      className: "".concat(prefixCls, "-preview ").concat(language ? "language-".concat(language) : ''),
      dangerouslySetInnerHTML: {
        __html: htmlStr
      }
    });
  }, // eslint-disable-next-line react-hooks/exhaustive-deps
  [prefixCls, language, htmlStr]);
  return /*#__PURE__*/_react.default.createElement("div", {
    style: (0, _objectSpread2.default)((0, _objectSpread2.default)({}, styles.container), style),
    className: "".concat(prefixCls, " ").concat(className || '')
  }, /*#__PURE__*/_react.default.createElement("textarea", (0, _extends2.default)({
    autoComplete: "off",
    autoCorrect: "off",
    spellCheck: "false",
    autoCapitalize: "off"
  }, other, {
    placeholder: placeholder,
    onKeyDown: function onKeyDown(evn) {
      (0, _shortcuts.default)(evn);
      other.onKeyDown && other.onKeyDown(evn);
    },
    style: (0, _objectSpread2.default)((0, _objectSpread2.default)((0, _objectSpread2.default)((0, _objectSpread2.default)({}, styles.editor), styles.textarea), contentStyle), {}, {
      minHeight: minHeight
    }, placeholder && !value ? {
      WebkitTextFillColor: 'inherit'
    } : {}),
    ref: textRef,
    onChange: function onChange(evn) {
      setValue(evn.target.value);
      _onChange && _onChange(evn);
    },
    className: "".concat(prefixCls, "-text"),
    value: value
  })), preView);
});

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9pbmRleC50c3giXSwibmFtZXMiOlsiUmVhY3QiLCJmb3J3YXJkUmVmIiwicHJvcHMiLCJyZWYiLCJwcmVmaXhDbHMiLCJfIiwidmFsdWUiLCJwYWRkaW5nIiwibWluSGVpZ2h0IiwicGxhY2Vob2xkZXIiLCJsYW5ndWFnZSIsImNsYXNzTmFtZSIsInN0eWxlIiwib25DaGFuZ2UiLCJvdGhlciIsInNldFZhbHVlIiwidGV4dFJlZiIsImN1cnJlbnQiLCJjb250ZW50U3R5bGUiLCJwYWRkaW5nVG9wIiwicGFkZGluZ1JpZ2h0IiwicGFkZGluZ0JvdHRvbSIsInBhZGRpbmdMZWZ0IiwiaHRtbFN0ciIsIlN0cmluZyIsInByZVZpZXciLCJzdHlsZXMiLCJlZGl0b3IiLCJfX2h0bWwiLCJjb250YWluZXIiLCJldm4iLCJvbktleURvd24iLCJ0ZXh0YXJlYSIsIldlYmtpdFRleHRGaWxsQ29sb3IiLCJ0YXJnZXQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7OzRCQWtCZUEsZUFBTUMsVUFBTixDQUErRCxVQUFDQyxLQUFELEVBQVFDLEdBQVIsRUFBZ0I7QUFDNUYseUJBV0lELEtBWEosQ0FDRUUsU0FERjtBQUFBLE1BQ0VBLFNBREYsaUNBQ2MsYUFEZDtBQUFBLE1BRVNDLENBRlQsR0FXSUgsS0FYSixDQUVFSSxLQUZGO0FBQUEsdUJBV0lKLEtBWEosQ0FHRUssT0FIRjtBQUFBLE1BR0VBLE9BSEYsK0JBR1ksRUFIWjtBQUFBLHlCQVdJTCxLQVhKLENBSUVNLFNBSkY7QUFBQSxNQUlFQSxTQUpGLGlDQUljLEVBSmQ7QUFBQSxNQUtFQyxXQUxGLEdBV0lQLEtBWEosQ0FLRU8sV0FMRjtBQUFBLE1BTUVDLFFBTkYsR0FXSVIsS0FYSixDQU1FUSxRQU5GO0FBQUEsTUFPRUMsU0FQ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QUNBTyxNQUFBQSxTQUFRLElBQUlBLFNBQVEsQ0FBQ2lCLEdBQUQsQ0FBcEI7QUFDRCxLQXRCSDtBQXVCRSxJQUFBLFNBQVMsWUFBSzFCLFNBQUwsVUF2Qlg7QUF3QkUsSUFBQSxLQUFLLEVBQUVFO0FBeEJULEtBREYsRUEyQkdtQixPQTNCSCxDQURGO0FBK0JELENBaEZjLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VJbXBlcmF0aXZlSGFuZGxlLCB1c2VNZW1vLCB1c2VSZWYsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgcHJvY2Vzc0h0bWwsIGh0bWxFbmNvZGUgfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCBzaG9ydGN1dHMgZnJvbSAnLi9zaG9ydGN1dHMnO1xuaW1wb3J0ICogYXMgc3R5bGVzIGZyb20gJy4vc3R5bGVzJztcbmltcG9ydCAnLi9zdHlsZS9pbmRleC5sZXNzJztcblxuZXhwb3J0ICogZnJvbSAnLi9TZWxlY3Rpb25UZXh0JztcblxuZXhwb3J0IGludGVyZmFjZSBUZXh0YXJlYUNvZGVFZGl0b3JQcm9wcyBleHRlbmRzIFJlYWN0LlRleHRhcmVhSFRNTEF0dHJpYnV0ZXM8SFRNTFRleHRBcmVhRWxlbWVudD4ge1xuICBwcmVmaXhDbHM/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBTZXQgd2hhdCBwcm9ncmFtbWluZyBsYW5ndWFnZSB0aGUgY29kZSBiZWxvbmdzIHRvLlxuICAgKi9cbiAgbGFuZ3VhZ2U/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBPcHRpb25hbCBwYWRkaW5nIGZvciBjb2RlLiBEZWZhdWx0OiBgMTBgLlxuICAgKi9cbiAgcGFkZGluZz86IG51bWJlcjtcbiAgLyoqXG4gICAqIFRoZSBtaW5pbXVtIGhlaWdodCBvZiB0aGUgZWRpdG9yLiBEZWZhdWx0OiBgMTZgLlxuICAgKi9cbiAgbWluSGVpZ2h0PzogbnVtYmVyO1xufVxuXG5leHBvcnQgZGVmYXVsdCBSZWFjdC5mb3J3YXJkUmVmPEhUTUxUZXh0QXJlYUVsZW1lbnQsIFRleHRhcmVhQ29kZUVkaXRvclByb3BzPigocHJvcHMsIHJlZikgPT4ge1xuICBjb25zdCB7XG4gICAgcHJlZml4Q2xzID0gJ3ctdGMtZWRpdG9yJyxcbiAgICB2YWx1ZTogXyxcbiAgICBwYWRkaW5nID0gMTAsXG4gICAgbWluSGVpZ2h0ID0gMTYsXG4gICAgcGxhY2Vob2xkZXIsXG4gICAgbGFuZ3VhZ2UsXG4gICAgY2xhc3NOYW1lLFxuICAgIHN0eWxlLFxuICAgIG9uQ2hhbmdlLFxuICAgIC4uLm90aGVyXG4gIH0gPSBwcm9wcztcblxuICBjb25zdCBbdmFsdWUsIHNldFZhbHVlXSA9IHVzZVN0YXRlKHByb3BzLnZhbHVlIHx8ICcnKTtcbiAgdXNlRWZmZWN0KCgpID0+IHNldFZhbHVlKHByb3BzLnZhbHVlIHx8ICcnKSwgW3Byb3BzLnZhbHVlXSk7XG4gIGNvbnN0IHRleHRSZWYgPSB1c2VSZWY8SFRNTFRleHRBcmVhRWxlbWVudD4obnVsbCk7XG4gIHVzZUltcGVyYXRpdmVIYW5kbGU8SFRNTFRleHRBcmVhRWxlbWVudCwgSFRNTFRleHRBcmVhRWxlbWVudD4ocmVmLCAoKSA9PiB0ZXh0UmVmLmN1cnJlbnQhKTtcblxuICBjb25zdCBjb250ZW50U3R5bGUgPSB7XG4gICAgcGFkZGluZ1RvcDogcGFkZGluZyxcbiAgICBwYWRkaW5nUmlnaHQ6IHBhZGRpbmcsXG4gICAgcGFkZGluZ0JvdHRvbTogcGFkZGluZyxcbiAgICBwYWRkaW5nTGVmdDogcGFkZGluZyxcbiAgfTtcblxuICBjb25zdCBodG1sU3RyID0gdXNlTWVtbyhcbiAgICAoKSA9PlxuICAgICAgcHJvY2Vzc0h0bWwoXG4gICAgICAgIGA8cHJlIGFyaWEtaGlkZGVuPXRydWU+PGNvZGUgJHtsYW5ndWFnZSA/IGBjbGFzcz1cImxhbmd1YWdlLSR7bGFuZ3VhZ2V9XCJgIDogJyd9ID4ke2h0bWxFbmNvZGUoXG4gICAgICAgICAgU3RyaW5nKHZhbHVlIHx8ICcnKSxcbiAgICAgICAgKX08L2NvZGU+PGJyIC8+PC9wcmU+YCxcbiAgICAgICksXG4gICAgW3ZhbHVlLCBsYW5ndWFnZV0sXG4gICk7XG4gIGNvbnN0IHByZVZpZXcgPSB1c2VNZW1vKFxuICAgICgpID0+IChcbiAgICAgIDxkaXZcbiAgICAgICAgc3R5bGU9e3sgLi4uc3R5bGVzLmVkaXRvciwgLi4uY29udGVudFN0eWxlLCBtaW5IZWlnaHQgfX1cbiAgICAgICAgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LXByZXZpZXcgJHtsYW5ndWFnZSA/IGBsYW5ndWFnZS0ke2xhbmd1YWdlfWAgOiAnJ31gfVxuICAgICAgICBkYW5nZXJvdXNseVNldElubmVySFRNTD17e1xuICAgICAgICAgIF9faHRtbDogaHRtbFN0cixcbiAgICAgICAgfX1cbiAgICAgIC8+XG4gICAgKSxcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gICAgW3ByZWZpeENscywgbGFuZ3VhZ2UsIGh0bWxTdHJdLFxuICApO1xuXG4gIHJldHVybiAoXG4gICAgPGRpdiBzdHlsZT17eyAuLi5zdHlsZXMuY29udGFpbmVyLCAuLi5zdHlsZSB9fSBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30gJHtjbGFzc05hbWUgfHwgJyd9YH0+XG4gICAgICA8dGV4dGFyZWFcbiAgICAgICAgYXV0b0NvbXBsZXRlPVwib2ZmXCJcbiAgICAgICAgYXV0b0NvcnJlY3Q9XCJvZmZcIlxuICAgICAgICBzcGVsbENoZWNrPVwiZmFsc2VcIlxuICAgICAgICBhdXRvQ2FwaXRhbGl6ZT1cIm9mZlwiXG4gICAgICAgIHsuLi5vdGhlcn1cbiAgICAgICAgcGxhY2Vob2xkZXI9e3BsYWNlaG9sZGVyfVxuICAgICAgICBvbktleURvd249eyhldm4pID0+IHtcbiAgICAgICAgICBzaG9ydGN1dHMoZXZuKTtcbiAgICAgICAgICBvdGhlci5vbktleURvd24gJiYgb3RoZXIub25LZXlEb3duKGV2bik7XG4gICAgICAgIH19XG4gICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgLi4uc3R5bGVzLmVkaXRvcixcbiAgICAgICAgICAuLi5zdHlsZXMudGV4dGFyZWEsXG4gICAgICAgICAgLi4uY29udGVudFN0eWxlLFxuICAgICAgICAgIG1pbkhlaWdodCxcbiAgICAgICAgICAuLi4ocGxhY2Vob2xkZXIgJiYgIXZhbHVlID8geyBXZWJraXRUZXh0RmlsbENvbG9yOiAnaW5oZXJpdCcgfSA6IHt9KSxcbiAgICAgICAgfX1cbiAgICAgICAgcmVmPXt0ZXh0UmVmfVxuICAgICAgICBvbkNoYW5nZT17KGV2bikgPT4ge1xuICAgICAgICAgIHNldFZhbHVlKGV2bi50YXJnZXQudmFsdWUpO1xuICAgICAgICAgIG9uQ2hhbmdlICYmIG9uQ2hhbmdlKGV2bik7XG4gICAgICAgIH19XG4gICAgICAgIGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS10ZXh0YH1cbiAgICAgICAgdmFsdWU9e3ZhbHVlfVxuICAgICAgLz5cbiAgICAgIHtwcmVWaWV3fVxuICAgIDwvZGl2PlxuICApO1xufSk7XG4iXX0=