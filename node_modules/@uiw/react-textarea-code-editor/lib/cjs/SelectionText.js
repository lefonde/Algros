"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SelectionText = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var SelectionText = /*#__PURE__*/function () {
  function SelectionText(elm) {
    (0, _classCallCheck2.default)(this, SelectionText);
    this.elm = void 0;
    this.start = void 0;
    this.end = void 0;
    this.value = void 0;
    var selectionStart = elm.selectionStart,
        selectionEnd = elm.selectionEnd;
    this.elm = elm;
    this.start = selectionStart;
    this.end = selectionEnd;
    this.value = this.elm.value;
  }

  (0, _createClass2.default)(SelectionText, [{
    key: "position",
    value: function position(start, end) {
      var _this$elm = this.elm,
          selectionStart = _this$elm.selectionStart,
          selectionEnd = _this$elm.selectionEnd;
      this.start = typeof start === 'number' && !isNaN(start) ? start : selectionStart;
      this.end = typeof end === 'number' && !isNaN(end) ? end : selectionEnd;
      this.elm.selectionStart = this.start;
      this.elm.selectionEnd = this.end;
      return this;
    }
  }, {
    key: "insertText",
    value: function insertText(text) {
      // Most of the used APIs only work with the field selected
      this.elm.focus();
      this.elm.setRangeText(text);
      this.value = this.elm.value;
      this.position();
      return this;
    }
  }, {
    key: "getSelectedValue",
    value: function getSelectedValue(start, end) {
      var _this$elm2 = this.elm,
          selectionStart = _this$elm2.selectionStart,
          selectionEnd = _this$elm2.selectionEnd;
      return this.value.slice(typeof start === 'number' && !isNaN(start) ? start : selectionStart, typeof end === 'number' && !isNaN(end) ? start : selectionEnd);
    }
  }, {
    key: "getLineStartNumber",
    value: function getLineStartNumber() {
      var start = this.start;

      while (start > 0) {
        start--;

        if (this.value.charAt(start) === '\n') {
          start++;
          break;
        }
      }

      return start;
    }
    /** Indent on new lines */

  }, {
    key: "getIndentText",
    value: function getIndentText() {
      var start = this.getLineStartNumber();
      var str = this.getSelectedValue(start);
      var indent = '';
      str.replace(/(^(\s)+)/, function (str, old) {
        return indent = old;
      });
      return indent;
    }
  }, {
    key: "lineStarInstert",
    value: function lineStarInstert(text) {
      if (text) {
        var oldStart = this.start;
        var start = this.getLineStartNumber();
        var str = this.getSelectedValue(start);
        this.position(start, this.end).insertText(str.split('\n').map(function (txt) {
          return text + txt;
        }).join('\n')).position(oldStart + text.length, this.end);
      }

      return this;
    }
  }, {
    key: "lineStarRemove",
    value: function lineStarRemove(text) {
      if (text) {
        var oldStart = this.start;
        var start = this.getLineStartNumber();
        var str = this.getSelectedValue(start);
        var reg = new RegExp("^".concat(text), 'g');
        var newStart = oldStart - text.length;

        if (!reg.test(str)) {
          newStart = oldStart;
        }

        this.position(start, this.end).insertText(str.split('\n').map(function (txt) {
          return txt.replace(reg, '');
        }).join('\n')).position(newStart, this.end);
      }
    }
    /** Notify any possible listeners of the change */

  }, {
    key: "notifyChange",
    value: function notifyChange() {
      var event = new Event('input', {
        bubbles: true,
        cancelable: false
      });
      this.elm.dispatchEvent(event);
    }
  }]);
  return SelectionText;
}();

exports.SelectionText = SelectionText;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9TZWxlY3Rpb25UZXh0LnRzIl0sIm5hbWVzIjpbIlNlbGVjdGlvblRleHQiLCJlbG0iLCJzdGFydCIsImVuZCIsInZhbHVlIiwic2VsZWN0aW9uU3RhcnQiLCJzZWxlY3Rpb25FbmQiLCJpc05hTiIsInRleHQiLCJmb2N1cyIsInNldFJhbmdlVGV4dCIsInBvc2l0aW9uIiwic2xpY2UiLCJjaGFyQXQiLCJnZXRMaW5lU3RhcnROdW1iZXIiLCJzdHIiLCJnZXRTZWxlY3RlZFZhbHVlIiwiaW5kZW50IiwicmVwbGFjZSIsIm9sZCIsIm9sZFN0YXJ0IiwiaW5zZXJ0VGV4dCIsInNwbGl0IiwibWFwIiwidHh0Iiwiam9pbiIsImxlbmd0aCIsInJlZyIsIlJlZ0V4cCIsIm5ld1N0YXJ0IiwidGVzdCIsImV2ZW50IiwiRXZlbnQiLCJidWJibGVzIiwiY2FuY2VsYWJsZSIsImRpc3BhdGNoRXZlbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7SUFBYUEsYTtBQUtYLHlCQUFZQyxHQUFaLEVBQXNDO0FBQUE7QUFBQSxTQUp0Q0EsR0FJc0M7QUFBQSxTQUh0Q0MsS0FHc0M7QUFBQSxTQUZ0Q0MsR0FFc0M7QUFBQSxTQUR0Q0MsS0FDc0M7QUFDcEMsUUFBUUMsY0FBUixHQUF5Q0osR0FBekMsQ0FBUUksY0FBUjtBQUFBLFFBQXdCQyxZQUF4QixHQUF5Q0wsR0FBekMsQ0FBd0JLLFlBQXhCO0FBQ0EsU0FBS0wsR0FBTCxHQUFXQSxHQUFYO0FBQ0EsU0FBS0MsS0FBTCxHQUFhRyxjQUFiO0FBQ0EsU0FBS0YsR0FBTCxHQUFXRyxZQUFYO0FBQ0EsU0FBS0YsS0FBTCxHQUFhLEtBQUtILEdBQUwsQ0FBU0csS0FBdEI7QUFDRDs7OztXQUNELGtCQUFTRixLQUFULEVBQXlCQyxHQUF6QixFQUF1QztBQUNyQyxzQkFBeUMsS0FBS0YsR0FBOUM7QUFBQSxVQUFRSSxjQUFSLGFBQVFBLGNBQVI7QUFBQSxVQUF3QkMsWUFBeEIsYUFBd0JBLFlBQXhCO0FBQ0Es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QUFDUixZQUFNWSxRQUFRLEdBQUcsS0FBS2xCLEtBQXRCO0FBQ0EsWUFBTUEsS0FBSyxHQUFHLEtBQUtZLGtCQUFMLEVBQWQ7QUFDQSxZQUFNQyxHQUFHLEdBQUcsS0FBS0MsZ0JBQUwsQ0FBc0JkLEtBQXRCLENBQVo7QUFDQSxZQUFNeUIsR0FBRyxHQUFHLElBQUlDLE1BQUosWUFBZXBCLElBQWYsR0FBdUIsR0FBdkIsQ0FBWjtBQUNBLFlBQUlxQixRQUFRLEdBQUdULFFBQVEsR0FBR1osSUFBSSxDQUFDa0IsTUFBL0I7O0FBQ0EsWUFBSSxDQUFDQyxHQUFHLENBQUNHLElBQUosQ0FBU2YsR0FBVCxDQUFMLEVBQW9CO0FBQ2xCYyxVQUFBQSxRQUFRLEdBQUdULFFBQVg7QUFDRDs7QUFDRCxhQUFLVCxRQUFMLENBQWNULEtBQWQsRUFBcUIsS0FBS0MsR0FBMUIsRUFDR2tCLFVBREgsQ0FFSU4sR0FBRyxDQUNBTyxLQURILENBQ1MsSUFEVCxFQUVHQyxHQUZILENBRU8sVUFBQ0MsR0FBRDtBQUFBLGlCQUFTQSxHQUFHLENBQUNOLE9BQUosQ0FBWVMsR0FBWixFQUFpQixFQUFqQixDQUFUO0FBQUEsU0FGUCxFQUdHRixJQUhILENBR1EsSUFIUixDQUZKLEVBT0dkLFFBUEgsQ0FPWWtCLFFBUFosRUFPc0IsS0FBSzFCLEdBUDNCO0FBUUQ7QUFDRjtBQUNEOzs7O1dBQ0Esd0JBQWU7QUFDYixVQUFNNEIsS0FBSyxHQUFHLElBQUlDLEtBQUosQ0FBVSxPQUFWLEVBQW1CO0FBQUVDLFFBQUFBLE9BQU8sRUFBRSxJQUFYO0FBQWlCQyxRQUFBQSxVQUFVLEVBQUU7QUFBN0IsT0FBbkIsQ0FBZDtBQUNBLFdBQUtqQyxHQUFMLENBQVNrQyxhQUFULENBQXVCSixLQUF2QjtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIFNlbGVjdGlvblRleHQge1xuICBlbG06IEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG4gIHN0YXJ0OiBudW1iZXI7XG4gIGVuZDogbnVtYmVyO1xuICB2YWx1ZTogc3RyaW5nO1xuICBjb25zdHJ1Y3RvcihlbG06IEhUTUxUZXh0QXJlYUVsZW1lbnQpIHtcbiAgICBjb25zdCB7IHNlbGVjdGlvblN0YXJ0LCBzZWxlY3Rpb25FbmQgfSA9IGVsbTtcbiAgICB0aGlzLmVsbSA9IGVsbTtcbiAgICB0aGlzLnN0YXJ0ID0gc2VsZWN0aW9uU3RhcnQ7XG4gICAgdGhpcy5lbmQgPSBzZWxlY3Rpb25FbmQ7XG4gICAgdGhpcy52YWx1ZSA9IHRoaXMuZWxtLnZhbHVlO1xuICB9XG4gIHBvc2l0aW9uKHN0YXJ0PzogbnVtYmVyLCBlbmQ/OiBudW1iZXIpIHtcbiAgICBjb25zdCB7IHNlbGVjdGlvblN0YXJ0LCBzZWxlY3Rpb25FbmQgfSA9IHRoaXMuZWxtO1xuICAgIHRoaXMuc3RhcnQgPSB0eXBlb2Ygc3RhcnQgPT09ICdudW1iZXInICYmICFpc05hTihzdGFydCkgPyBzdGFydCA6IHNlbGVjdGlvblN0YXJ0O1xuICAgIHRoaXMuZW5kID0gdHlwZW9mIGVuZCA9PT0gJ251bWJlcicgJiYgIWlzTmFOKGVuZCkgPyBlbmQgOiBzZWxlY3Rpb25FbmQ7XG4gICAgdGhpcy5lbG0uc2VsZWN0aW9uU3RhcnQgPSB0aGlzLnN0YXJ0O1xuICAgIHRoaXMuZWxtLnNlbGVjdGlvbkVuZCA9IHRoaXMuZW5kO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIGluc2VydFRleHQodGV4dDogc3RyaW5nKSB7XG4gICAgLy8gTW9zdCBvZiB0aGUgdXNlZCBBUElzIG9ubHkgd29yayB3aXRoIHRoZSBmaWVsZCBzZWxlY3RlZFxuICAgIHRoaXMuZWxtLmZvY3VzKCk7XG4gICAgdGhpcy5lbG0uc2V0UmFuZ2VUZXh0KHRleHQpO1xuICAgIHRoaXMudmFsdWUgPSB0aGlzLmVsbS52YWx1ZTtcbiAgICB0aGlzLnBvc2l0aW9uKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgZ2V0U2VsZWN0ZWRWYWx1ZShzdGFydD86IG51bWJlciwgZW5kPzogbnVtYmVyKSB7XG4gICAgY29uc3QgeyBzZWxlY3Rpb25TdGFydCwgc2VsZWN0aW9uRW5kIH0gPSB0aGlzLmVsbTtcbiAgICByZXR1cm4gdGhpcy52YWx1ZS5zbGljZShcbiAgICAgIHR5cGVvZiBzdGFydCA9PT0gJ251bWJlcicgJiYgIWlzTmFOKHN0YXJ0KSA/IHN0YXJ0IDogc2VsZWN0aW9uU3RhcnQsXG4gICAgICB0eXBlb2YgZW5kID09PSAnbnVtYmVyJyAmJiAhaXNOYU4oZW5kKSA/IHN0YXJ0IDogc2VsZWN0aW9uRW5kLFxuICAgICk7XG4gIH1cbiAgZ2V0TGluZVN0YXJ0TnVtYmVyKCkge1xuICAgIGxldCBzdGFydCA9IHRoaXMuc3RhcnQ7XG4gICAgd2hpbGUgKHN0YXJ0ID4gMCkge1xuICAgICAgc3RhcnQtLTtcbiAgICAgIGlmICh0aGlzLnZhbHVlLmNoYXJBdChzdGFydCkgPT09ICdcXG4nKSB7XG4gICAgICAgIHN0YXJ0Kys7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gc3RhcnQ7XG4gIH1cbiAgLyoqIEluZGVudCBvbiBuZXcgbGluZXMgKi9cbiAgZ2V0SW5kZW50VGV4dCgpIHtcbiAgICBjb25zdCBzdGFydCA9IHRoaXMuZ2V0TGluZVN0YXJ0TnVtYmVyKCk7XG4gICAgY29uc3Qgc3RyID0gdGhpcy5nZXRTZWxlY3RlZFZhbHVlKHN0YXJ0KTtcbiAgICBsZXQgaW5kZW50ID0gJyc7XG4gICAgc3RyLnJlcGxhY2UoLyheKFxccykrKS8sIChzdHIsIG9sZCkgPT4gKGluZGVudCA9IG9sZCkpO1xuICAgIHJldHVybiBpbmRlbnQ7XG4gIH1cbiAgbGluZVN0YXJJbnN0ZXJ0KHRleHQ6IHN0cmluZykge1xuICAgIGlmICh0ZXh0KSB7XG4gICAgICBjb25zdCBvbGRTdGFydCA9IHRoaXMuc3RhcnQ7XG4gICAgICBjb25zdCBzdGFydCA9IHRoaXMuZ2V0TGluZVN0YXJ0TnVtYmVyKCk7XG4gICAgICBjb25zdCBzdHIgPSB0aGlzLmdldFNlbGVjdGVkVmFsdWUoc3RhcnQpO1xuICAgICAgdGhpcy5wb3NpdGlvbihzdGFydCwgdGhpcy5lbmQpXG4gICAgICAgIC5pbnNlcnRUZXh0KFxuICAgICAgICAgIHN0clxuICAgICAgICAgICAgLnNwbGl0KCdcXG4nKVxuICAgICAgICAgICAgLm1hcCgodHh0KSA9PiB0ZXh0ICsgdHh0KVxuICAgICAgICAgICAgLmpvaW4oJ1xcbicpLFxuICAgICAgICApXG4gICAgICAgIC5wb3NpdGlvbihvbGRTdGFydCArIHRleHQubGVuZ3RoLCB0aGlzLmVuZCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIGxpbmVTdGFyUmVtb3ZlKHRleHQ6IHN0cmluZykge1xuICAgIGlmICh0ZXh0KSB7XG4gICAgICBjb25zdCBvbGRTdGFydCA9IHRoaXMuc3RhcnQ7XG4gICAgICBjb25zdCBzdGFydCA9IHRoaXMuZ2V0TGluZVN0YXJ0TnVtYmVyKCk7XG4gICAgICBjb25zdCBzdHIgPSB0aGlzLmdldFNlbGVjdGVkVmFsdWUoc3RhcnQpO1xuICAgICAgY29uc3QgcmVnID0gbmV3IFJlZ0V4cChgXiR7dGV4dH1gLCAnZycpO1xuICAgICAgbGV0IG5ld1N0YXJ0ID0gb2xkU3RhcnQgLSB0ZXh0Lmxlbmd0aDtcbiAgICAgIGlmICghcmVnLnRlc3Qoc3RyKSkge1xuICAgICAgICBuZXdTdGFydCA9IG9sZFN0YXJ0O1xuICAgICAgfVxuICAgICAgdGhpcy5wb3NpdGlvbihzdGFydCwgdGhpcy5lbmQpXG4gICAgICAgIC5pbnNlcnRUZXh0KFxuICAgICAgICAgIHN0clxuICAgICAgICAgICAgLnNwbGl0KCdcXG4nKVxuICAgICAgICAgICAgLm1hcCgodHh0KSA9PiB0eHQucmVwbGFjZShyZWcsICcnKSlcbiAgICAgICAgICAgIC5qb2luKCdcXG4nKSxcbiAgICAgICAgKVxuICAgICAgICAucG9zaXRpb24obmV3U3RhcnQsIHRoaXMuZW5kKTtcbiAgICB9XG4gIH1cbiAgLyoqIE5vdGlmeSBhbnkgcG9zc2libGUgbGlzdGVuZXJzIG9mIHRoZSBjaGFuZ2UgKi9cbiAgbm90aWZ5Q2hhbmdlKCkge1xuICAgIGNvbnN0IGV2ZW50ID0gbmV3IEV2ZW50KCdpbnB1dCcsIHsgYnViYmxlczogdHJ1ZSwgY2FuY2VsYWJsZTogZmFsc2UgfSk7XG4gICAgdGhpcy5lbG0uZGlzcGF0Y2hFdmVudChldmVudCk7XG4gIH1cbn1cbiJdfQ==