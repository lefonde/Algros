import _classCallCheck from "@babel/runtime/helpers/classCallCheck";
import _createClass from "@babel/runtime/helpers/createClass";
export var SelectionText = /*#__PURE__*/function () {
  function SelectionText(elm) {
    _classCallCheck(this, SelectionText);

    this.elm = void 0;
    this.start = void 0;
    this.end = void 0;
    this.value = void 0;
    var selectionStart = elm.selectionStart,
        selectionEnd = elm.selectionEnd;
    this.elm = elm;
    this.start = selectionStart;
    this.end = selectionEnd;
    this.value = this.elm.value;
  }

  _createClass(SelectionText, [{
    key: "position",
    value: function position(start, end) {
      var _this$elm = this.elm,
          selectionStart = _this$elm.selectionStart,
          selectionEnd = _this$elm.selectionEnd;
      this.start = typeof start === 'number' && !isNaN(start) ? start : selectionStart;
      this.end = typeof end === 'number' && !isNaN(end) ? end : selectionEnd;
      this.elm.selectionStart = this.start;
      this.elm.selectionEnd = this.end;
      return this;
    }
  }, {
    key: "insertText",
    value: function insertText(text) {
      // Most of the used APIs only work with the field selected
      this.elm.focus();
      this.elm.setRangeText(text);
      this.value = this.elm.value;
      this.position();
      return this;
    }
  }, {
    key: "getSelectedValue",
    value: function getSelectedValue(start, end) {
      var _this$elm2 = this.elm,
          selectionStart = _this$elm2.selectionStart,
          selectionEnd = _this$elm2.selectionEnd;
      return this.value.slice(typeof start === 'number' && !isNaN(start) ? start : selectionStart, typeof end === 'number' && !isNaN(end) ? start : selectionEnd);
    }
  }, {
    key: "getLineStartNumber",
    value: function getLineStartNumber() {
      var start = this.start;

      while (start > 0) {
        start--;

        if (this.value.charAt(start) === '\n') {
          start++;
          break;
        }
      }

      return start;
    }
    /** Indent on new lines */

  }, {
    key: "getIndentText",
    value: function getIndentText() {
      var start = this.getLineStartNumber();
      var str = this.getSelectedValue(start);
      var indent = '';
      str.replace(/(^(\s)+)/, function (str, old) {
        return indent = old;
      });
      return indent;
    }
  }, {
    key: "lineStarInstert",
    value: function lineStarInstert(text) {
      if (text) {
        var oldStart = this.start;
        var start = this.getLineStartNumber();
        var str = this.getSelectedValue(start);
        this.position(start, this.end).insertText(str.split('\n').map(function (txt) {
          return text + txt;
        }).join('\n')).position(oldStart + text.length, this.end);
      }

      return this;
    }
  }, {
    key: "lineStarRemove",
    value: function lineStarRemove(text) {
      if (text) {
        var oldStart = this.start;
        var start = this.getLineStartNumber();
        var str = this.getSelectedValue(start);
        var reg = new RegExp("^".concat(text), 'g');
        var newStart = oldStart - text.length;

        if (!reg.test(str)) {
          newStart = oldStart;
        }

        this.position(start, this.end).insertText(str.split('\n').map(function (txt) {
          return txt.replace(reg, '');
        }).join('\n')).position(newStart, this.end);
      }
    }
    /** Notify any possible listeners of the change */

  }, {
    key: "notifyChange",
    value: function notifyChange() {
      var event = new Event('input', {
        bubbles: true,
        cancelable: false
      });
      this.elm.dispatchEvent(event);
    }
  }]);

  return SelectionText;
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9TZWxlY3Rpb25UZXh0LnRzIl0sIm5hbWVzIjpbIlNlbGVjdGlvblRleHQiLCJlbG0iLCJzdGFydCIsImVuZCIsInZhbHVlIiwic2VsZWN0aW9uU3RhcnQiLCJzZWxlY3Rpb25FbmQiLCJpc05hTiIsInRleHQiLCJmb2N1cyIsInNldFJhbmdlVGV4dCIsInBvc2l0aW9uIiwic2xpY2UiLCJjaGFyQXQiLCJnZXRMaW5lU3RhcnROdW1iZXIiLCJzdHIiLCJnZXRTZWxlY3RlZFZhbHVlIiwiaW5kZW50IiwicmVwbGFjZSIsIm9sZCIsIm9sZFN0YXJ0IiwiaW5zZXJ0VGV4dCIsInNwbGl0IiwibWFwIiwidHh0Iiwiam9pbiIsImxlbmd0aCIsInJlZyIsIlJlZ0V4cCIsIm5ld1N0YXJ0IiwidGVzdCIsImV2ZW50IiwiRXZlbnQiLCJidWJibGVzIiwiY2FuY2VsYWJsZSIsImRpc3BhdGNoRXZlbnQiXSwibWFwcGluZ3MiOiI7O0FBQUEsV0FBYUEsYUFBYjtBQUtFLHlCQUFZQyxHQUFaLEVBQXNDO0FBQUE7O0FBQUEsU0FKdENBLEdBSXNDO0FBQUEsU0FIdENDLEtBR3NDO0FBQUEsU0FGdENDLEdBRXNDO0FBQUEsU0FEdENDLEtBQ3NDO0FBQ3BDLFFBQVFDLGNBQVIsR0FBeUNKLEdBQXpDLENBQVFJLGNBQVI7QUFBQSxRQUF3QkMsWUFBeEIsR0FBeUNMLEdBQXpDLENBQXdCSyxZQUF4QjtBQUNBLFNBQUtMLEdBQUwsR0FBV0EsR0FBWDtBQUNBLFNBQUtDLEtBQUwsR0FBYUcsY0FBYjtBQUNBLFNBQUtGLEdBQUwsR0FBV0csWUFBWDtBQUNBLFNBQUtGLEtBQUwsR0FBYSxLQUFLSCxHQUFMLENBQVNHLEtBQXRCO0FBQ0Q7O0FBWEg7QUFBQTtBQUFBLFdBWUUsa0JBQVNGLEtBQVQsRUFBeUJDLEdBQXpCLEVBQXVDO0FBQ3JDLHNCQUF5QyxLQUFLRixHQUE5QztBQUFBLFVBQVFJLGNBQVIsYUFBUUEsY0FBUjtBQUFBLFVBQXdCQyxZQUF4QixhQUF3QkEsWUFBeEI7QUFDQSxXQUFLSixLQUFMLEdBQWEsT0FBT0EsS0FBUCxLQUFpQixRQUFqQixJQUE2QixDQUFDSyxLQUFLLENBQUNMLEtBQUQsQ0FBbkMsR0FBNkNBLEtBQTdDLEdBQXFERyxjQUFsRTtBQUNBLFdBQUtGLEdBQUwsR0FBVyxPQUFPQSxHQUFQLEtBQWUsUUFBZixJQUEyQixDQUFDSSxLQUFLLENBQUNKLEdBQUQsQ0FBakMsR0FBeUNBLEdBQXpDLEdBQStDRyxZQUExRDtBQUNBLFdBQUtMLEdBQUwsQ0FBU0ksY0FBVCxHQUEwQixLQUFLSCxLQUEvQjtBQUNBLFdBQUtELEdBQUwsQ0FBU0ssWUFBVCxHQUF3QixLQUFLSCxHQUE3QjtBQUNBLGFBQU8sSUFBUDtBQUNEO0FBbkJIO0FBQUE7QUFBQSxXQW9CRSxvQkFBV0ssSUFBWCxFQUF5QjtBQUN2QjtBQUNBLFdBQUtQLEdBQUwsQ0FBU1EsS0FBVDtBQUNBLFdBQUtSLEdBQUwsQ0FBU1MsWUFBVCxDQUFzQkYsSUFBdEI7QUFDQSxXQUFLSixLQUFMLEdBQWEsS0FBS0gsR0FBTCxDQUFTRyxLQUF0QjtBQUNBLFdBQUtPLFFBQUw7QUFDQSxhQUFPLElBQVA7QUFDRDtBQTNCSDtBQUFBO0FBQUEsV0E0QkUsMEJBQWlCVCxLQUFqQixFQUFpQ0MsR0FBakMsRUFBK0M7QUFDN0MsdUJBQXlDLEtBQUtGLEdBQTlDO0FBQUEsVUFBUUksY0FBUixjQUFRQSxjQUFSO0FBQUEsVUFBd0JDLFlBQXhCLGNBQXdCQSxZQUF4QjtBQUNBLGFBQU8sS0FBS0YsS0FBTCxDQUFXUSxLQUFYLENBQ0wsT0FBT1YsS0FBUCxLQUFpQixRQUFqQixJQUE2QixDQUFDSyxLQUFLLENBQUNMLEtBQUQsQ0FBbkMsR0FBNkNBLEtBQTdDLEdBQXFERyxjQURoRCxFQUVMLE9BQU9GLEdBQVAsS0FBZSxRQUFmLElBQTJCLENBQUNJLEtBQUssQ0FBQ0osR0FBRCxDQUFqQyxHQUF5Q0QsS0FBekMsR0FBaURJLFlBRjVDLENBQVA7QUFJRDtBQWxDSDtBQUFBO0FBQUEsV0FtQ0UsOEJBQXFCO0FBQ25CLFVBQUlKLEtBQUssR0FBRyxLQUFLQSxLQUFqQjs7QUFDQSxhQUFPQSxLQUFLLEdBQUcsQ0FBZixFQUFrQjtBQUNoQkEsUUFBQUEsS0FBSzs7QUFDTCxZQUFJLEtBQUtFLEtBQUwsQ0FBV1MsTUFBWCxDQUFrQlgsS0FBbEIsTUFBNkIsSUFBakMsRUFBdUM7QUFDckNBLFVBQUFBLEtBQUs7QUFDTDtBQUNEO0FBQ0Y7O0FBQ0QsYUFBT0EsS0FBUDtBQUNEO0FBQ0Q7O0FBOUNGO0FBQUE7QUFBQSxXQStDRSx5QkFBZ0I7QUFDZCxVQUFNQSxLQUFLLEdBQUcsS0FBS1ksa0JBQUwsRUFBZDtBQUNBLFVBQU1DLEdBQUcsR0FBRyxLQUFLQyxnQkFBTCxDQUFzQmQsS0FBdEIsQ0FBWjtBQUNBLFVBQUllLE1BQU0sR0FBRyxFQUFiO0FBQ0FGLE1BQUFBLEdBQUcsQ0FBQ0csT0FBSixDQUFZLFVBQVosRUFBd0IsVUFBQ0gsR0FBRCxFQUFNSSxHQUFOO0FBQUEsZUFBZUYsTUFBTSxHQUFHRSxHQUF4QjtBQUFBLE9BQXhCO0FBQ0EsYUFBT0YsTUFBUDtBQUNEO0FBckRIO0FBQUE7QUFBQSxXQXNERSx5QkFBZ0JULElBQWhCLEVBQThCO0FBQzVCLFVBQUlBLElBQUosRUFBVTtBQUNSLFlBQU1ZLFFBQVEsR0FBRyxLQUFLbEIsS0FBdEI7QUFDQSxZQUFNQSxLQUFLLEdBQUcsS0FBS1ksa0JBQUwsRUFBZDtBQUNBLFlBQU1DLEdBQUcsR0FBRyxLQUFLQyxnQkFBTCxDQUFzQmQsS0FBdEIsQ0FBWjtBQUNBLGFBQUtTLFFBQUwsQ0FBY1QsS0FBZCxFQUFxQixLQUFLQyxHQUExQixFQUNHa0IsVUFESCxDQUVJTixHQUFHLENBQ0FPLEtBREgsQ0FDUyxJQURULEVBRUdDLEdBRkgsQ0FFTyxVQUFDQyxHQUFEO0FBQUEsaUJBQVNoQixJQUFJLEdBQUdnQixHQUFoQjtBQUFBLFNBRlAsRUFHR0MsSUFISCxDQUdRLElBSFIsQ0FGSixFQU9HZCxRQVBILENBT1lTLFFBQVEsR0FBR1osSUFBSSxDQUFDa0IsTUFQNUIsRUFPb0MsS0FBS3ZCLEdBUHpDO0FBUUQ7O0FBQ0QsYUFBTyxJQUFQO0FBQ0Q7QUFyRUg7QUFBQTtBQUFBLFdBc0VFLHdCQUFlSyxJQUFmLEVBQTZCO0FBQzNCLFVBQUlBLElBQUosRUFBVTtBQUNSLFlBQU1ZLFFBQVEsR0FBRyxLQUFLbEIsS0FBdEI7QUFDQSxZQUFNQSxLQUFLLEdBQUcsS0FBS1ksa0JBQUwsRUFBZDtBQUNBLFlBQU1DLEdBQUcsR0FBRyxLQUFLQyxnQkFBTCxDQUFzQmQsS0FBdEIsQ0FBWjtBQUNBLFlBQU15QixHQUFHLEdBQUcsSUFBSUMsTUFBSixZQUFlcEIsSUFBZixHQUF1QixHQUF2QixDQUFaO0FBQ0EsWUFBSXFCLFFBQVEsR0FBR1QsUUFBUSxHQUFHWixJQUFJLENBQUNrQixNQUEvQjs7QUFDQSxZQUFJLENBQUNDLEdBQUcsQ0FBQ0csSUFBSixDQUFTZixHQUFULENBQUwsRUFBb0I7QUFDbEJjLFVBQUFBLFFBQVEsR0FBR1QsUUFBWDtBQUNEOztBQUNELGFBQUtULFFBQUwsQ0FBY1QsS0FBZCxFQUFxQixLQUFLQyxHQUExQixFQUNHa0IsVUFESCxDQUVJTixHQUFHLENBQ0FPLEtBREgsQ0FDUyxJQURULEVBRUdDLEdBRkgsQ0FFTyxVQUFDQyxHQUFEO0FBQUEsaUJBQVNBLEdBQUcsQ0FBQ04sT0FBSixDQUFZUyxHQUFaLEVBQWlCLEVBQWpCLENBQVQ7QUFBQSxTQUZQLEVBR0dGLElBSEgsQ0FHUSxJQUhSLENBRkosRUFPR2QsUUFQSCxDQU9Za0IsUUFQWixFQU9zQixLQUFLMUIsR0FQM0I7QUFRRDtBQUNGO0FBQ0Q7O0FBMUZGO0FBQUE7QUFBQSxXQTJGRSx3QkFBZTtBQUNiLFVBQU00QixLQUFLLEdBQUcsSUFBSUMsS0FBSixDQUFVLE9BQVYsRUFBbUI7QUFBRUMsUUFBQUEsT0FBTyxFQUFFLElBQVg7QUFBaUJDLFFBQUFBLFVBQVUsRUFBRTtBQUE3QixPQUFuQixDQUFkO0FBQ0EsV0FBS2pDLEdBQUwsQ0FBU2tDLGFBQVQsQ0FBdUJKLEtBQXZCO0FBQ0Q7QUE5Rkg7O0FBQUE7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBTZWxlY3Rpb25UZXh0IHtcbiAgZWxtOiBIVE1MVGV4dEFyZWFFbGVtZW50O1xuICBzdGFydDogbnVtYmVyO1xuICBlbmQ6IG51bWJlcjtcbiAgdmFsdWU6IHN0cmluZztcbiAgY29uc3RydWN0b3IoZWxtOiBIVE1MVGV4dEFyZWFFbGVtZW50KSB7XG4gICAgY29uc3QgeyBzZWxlY3Rpb25TdGFydCwgc2VsZWN0aW9uRW5kIH0gPSBlbG07XG4gICAgdGhpcy5lbG0gPSBlbG07XG4gICAgdGhpcy5zdGFydCA9IHNlbGVjdGlvblN0YXJ0O1xuICAgIHRoaXMuZW5kID0gc2VsZWN0aW9uRW5kO1xuICAgIHRoaXMudmFsdWUgPSB0aGlzLmVsbS52YWx1ZTtcbiAgfVxuICBwb3NpdGlvbihzdGFydD86IG51bWJlciwgZW5kPzogbnVtYmVyKSB7XG4gICAgY29uc3QgeyBzZWxlY3Rpb25TdGFydCwgc2VsZWN0aW9uRW5kIH0gPSB0aGlzLmVsbTtcbiAgICB0aGlzLnN0YXJ0ID0gdHlwZW9mIHN0YXJ0ID09PSAnbnVtYmVyJyAmJiAhaXNOYU4oc3RhcnQpID8gc3RhcnQgOiBzZWxlY3Rpb25TdGFydDtcbiAgICB0aGlzLmVuZCA9IHR5cGVvZiBlbmQgPT09ICdudW1iZXInICYmICFpc05hTihlbmQpID8gZW5kIDogc2VsZWN0aW9uRW5kO1xuICAgIHRoaXMuZWxtLnNlbGVjdGlvblN0YXJ0ID0gdGhpcy5zdGFydDtcbiAgICB0aGlzLmVsbS5zZWxlY3Rpb25FbmQgPSB0aGlzLmVuZDtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBpbnNlcnRUZXh0KHRleHQ6IHN0cmluZykge1xuICAgIC8vIE1vc3Qgb2YgdGhlIHVzZWQgQVBJcyBvbmx5IHdvcmsgd2l0aCB0aGUgZmllbGQgc2VsZWN0ZWRcbiAgICB0aGlzLmVsbS5mb2N1cygpO1xuICAgIHRoaXMuZWxtLnNldFJhbmdlVGV4dCh0ZXh0KTtcbiAgICB0aGlzLnZhbHVlID0gdGhpcy5lbG0udmFsdWU7XG4gICAgdGhpcy5wb3NpdGlvbigpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIGdldFNlbGVjdGVkVmFsdWUoc3RhcnQ/OiBudW1iZXIsIGVuZD86IG51bWJlcikge1xuICAgIGNvbnN0IHsgc2VsZWN0aW9uU3RhcnQsIHNlbGVjdGlvbkVuZCB9ID0gdGhpcy5lbG07XG4gICAgcmV0dXJuIHRoaXMudmFsdWUuc2xpY2UoXG4gICAgICB0eXBlb2Ygc3RhcnQgPT09ICdudW1iZXInICYmICFpc05hTihzdGFydCkgPyBzdGFydCA6IHNlbGVjdGlvblN0YXJ0LFxuICAgICAgdHlwZW9mIGVuZCA9PT0gJ251bWJlcicgJiYgIWlzTmFOKGVuZCkgPyBzdGFydCA6IHNlbGVjdGlvbkVuZCxcbiAgICApO1xuICB9XG4gIGdldExpbmVTdGFydE51bWJlcigpIHtcbiAgICBsZXQgc3RhcnQgPSB0aGlzLnN0YXJ0O1xuICAgIHdoaWxlIChzdGFydCA+IDApIHtcbiAgICAgIHN0YXJ0LS07XG4gICAgICBpZiAodGhpcy52YWx1ZS5jaGFyQXQoc3RhcnQpID09PSAnXFxuJykge1xuICAgICAgICBzdGFydCsrO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN0YXJ0O1xuICB9XG4gIC8qKiBJbmRlbnQgb24gbmV3IGxpbmVzICovXG4gIGdldEluZGVudFRleHQoKSB7XG4gICAgY29uc3Qgc3RhcnQgPSB0aGlzLmdldExpbmVTdGFydE51bWJlcigpO1xuICAgIGNvbnN0IHN0ciA9IHRoaXMuZ2V0U2VsZWN0ZWRWYWx1ZShzdGFydCk7XG4gICAgbGV0IGluZGVudCA9ICcnO1xuICAgIHN0ci5yZXBsYWNlKC8oXihcXHMpKykvLCAoc3RyLCBvbGQpID0+IChpbmRlbnQgPSBvbGQpKTtcbiAgICByZXR1cm4gaW5kZW50O1xuICB9XG4gIGxpbmVTdGFySW5zdGVydCh0ZXh0OiBzdHJpbmcpIHtcbiAgICBpZiAodGV4dCkge1xuICAgICAgY29uc3Qgb2xkU3RhcnQgPSB0aGlzLnN0YXJ0O1xuICAgICAgY29uc3Qgc3RhcnQgPSB0aGlzLmdldExpbmVTdGFydE51bWJlcigpO1xuICAgICAgY29uc3Qgc3RyID0gdGhpcy5nZXRTZWxlY3RlZFZhbHVlKHN0YXJ0KTtcbiAgICAgIHRoaXMucG9zaXRpb24oc3RhcnQsIHRoaXMuZW5kKVxuICAgICAgICAuaW5zZXJ0VGV4dChcbiAgICAgICAgICBzdHJcbiAgICAgICAgICAgIC5zcGxpdCgnXFxuJylcbiAgICAgICAgICAgIC5tYXAoKHR4dCkgPT4gdGV4dCArIHR4dClcbiAgICAgICAgICAgIC5qb2luKCdcXG4nKSxcbiAgICAgICAgKVxuICAgICAgICAucG9zaXRpb24ob2xkU3RhcnQgKyB0ZXh0Lmxlbmd0aCwgdGhpcy5lbmQpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBsaW5lU3RhclJlbW92ZSh0ZXh0OiBzdHJpbmcpIHtcbiAgICBpZiAodGV4dCkge1xuICAgICAgY29uc3Qgb2xkU3RhcnQgPSB0aGlzLnN0YXJ0O1xuICAgICAgY29uc3Qgc3RhcnQgPSB0aGlzLmdldExpbmVTdGFydE51bWJlcigpO1xuICAgICAgY29uc3Qgc3RyID0gdGhpcy5nZXRTZWxlY3RlZFZhbHVlKHN0YXJ0KTtcbiAgICAgIGNvbnN0IHJlZyA9IG5ldyBSZWdFeHAoYF4ke3RleHR9YCwgJ2cnKTtcbiAgICAgIGxldCBuZXdTdGFydCA9IG9sZFN0YXJ0IC0gdGV4dC5sZW5ndGg7XG4gICAgICBpZiAoIXJlZy50ZXN0KHN0cikpIHtcbiAgICAgICAgbmV3U3RhcnQgPSBvbGRTdGFydDtcbiAgICAgIH1cbiAgICAgIHRoaXMucG9zaXRpb24oc3RhcnQsIHRoaXMuZW5kKVxuICAgICAgICAuaW5zZXJ0VGV4dChcbiAgICAgICAgICBzdHJcbiAgICAgICAgICAgIC5zcGxpdCgnXFxuJylcbiAgICAgICAgICAgIC5tYXAoKHR4dCkgPT4gdHh0LnJlcGxhY2UocmVnLCAnJykpXG4gICAgICAgICAgICAuam9pbignXFxuJyksXG4gICAgICAgIClcbiAgICAgICAgLnBvc2l0aW9uKG5ld1N0YXJ0LCB0aGlzLmVuZCk7XG4gICAgfVxuICB9XG4gIC8qKiBOb3RpZnkgYW55IHBvc3NpYmxlIGxpc3RlbmVycyBvZiB0aGUgY2hhbmdlICovXG4gIG5vdGlmeUNoYW5nZSgpIHtcbiAgICBjb25zdCBldmVudCA9IG5ldyBFdmVudCgnaW5wdXQnLCB7IGJ1YmJsZXM6IHRydWUsIGNhbmNlbGFibGU6IGZhbHNlIH0pO1xuICAgIHRoaXMuZWxtLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuICB9XG59XG4iXX0=